<!doctype html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Platformer</title>
<style>
body{margin:0;background:#0e0f14;color:#eee;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
#loading-screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;font-size:20px}
#game{display:block;width:100vw;height:100vh}
#error-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);color:#fff;padding:16px;white-space:pre-wrap;overflow:auto;display:none}
</style>
<link id="main-style" rel="stylesheet" href="styles.css"/>
<script src="version.js"></script>
<script>
function showError(err){
  const o=document.getElementById('error-overlay');
  o.textContent=(err&&err.stack)||err;
  o.style.display='block';
}
window.onerror=(msg,src,line,col,err)=>{showError(err||msg);};
window.onunhandledrejection=e=>{showError(e.reason);};
(function(){
  try{
    document.title=`Platformer — v${self.GAME_VERSION}`;
    const addVersion=u=>self.GAME_VERSION?`${u}?v=${self.GAME_VERSION}`:u;
    const link=document.getElementById('main-style');
    link.href=addVersion('styles.css');
    function loadScript(src){
      return new Promise((res,rej)=>{
        const s=document.createElement('script');
        s.src=src;
        s.onload=res;
        s.onerror=()=>rej(new Error('Failed to load '+src));
        document.head.appendChild(s);
      });
    }
    loadScript(addVersion('game.js')).catch(err=>{
      console.error(err);
      showError(err);
      return loadScript('game.js');
    }).catch(err=>{
      console.error(err);
      showError(err);
    });
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register(addVersion('sw.js')).then(()=>{
        navigator.serviceWorker.addEventListener('controllerchange',()=>location.reload());
      }).catch(err=>{
        console.error(err);
        showError(err);
      });
    }
  }catch(e){showError(e);}
})();
</script>
</head><body>
<div id="loading-screen">Loading…</div>
<canvas id="game"></canvas>
<div id="error-overlay"></div>
</body></html>
